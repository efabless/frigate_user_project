name: Run All
on: 
  push:
  workflow_dispatch:

jobs:
  Test:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v4
    - uses: ./.github/actions/setup-dependencies
      with:
        github-token: ${{ secrets.GITHUB_TOKEN }}
    - name: Setup Dependencies
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
      run: |
        make setup
    - name: Run RTL Verification
      env:
        COCOTB_ARGS: "--CI -verbosity debug"
      run: |
        make cocotb-verify-all-rtl
    - name: Debug
      if: always()
      run: |
          cat ./verilog/dv/cocotb/sim/*/*/*.log
    - uses: cachix/install-nix-action@v30
      with:
        extraPullNames: openlane
    - name: Run OpenLane
      run: make user_project_wrapper
